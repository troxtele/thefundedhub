import"./isomorphic-unfetch-d4090f51.js";import{b as m}from"./buffer-3efd43dc.js";import{b as N}from"./@aws-crypto-b6145858.js";import"./js-cookie-46d44e46.js";/*!
 * Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
 * SPDX-License-Identifier: Apache-2.0
 */var _t=function(){function r(n){var e=n||{},s=e.ValidationData,i=e.Username,o=e.Password,a=e.AuthParameters,u=e.ClientMetadata;this.validationData=s||{},this.authParameters=a||{},this.clientMetadata=u||{},this.username=i,this.password=o}var t=r.prototype;return t.getUsername=function(){return this.username},t.getPassword=function(){return this.password},t.getValidationData=function(){return this.validationData},t.getAuthParameters=function(){return this.authParameters},t.getClientMetadata=function(){return this.clientMetadata},r}(),A;typeof window<"u"&&window.crypto&&(A=window.crypto);!A&&typeof window<"u"&&window.msCrypto&&(A=window.msCrypto);!A&&typeof global<"u"&&global.crypto&&(A=global.crypto);if(!A&&typeof require=="function")try{A=require("crypto")}catch{}function pe(){if(A){if(typeof A.getRandomValues=="function")try{return A.getRandomValues(new Uint32Array(1))[0]}catch{}if(typeof A.randomBytes=="function")try{return A.randomBytes(4).readInt32LE()}catch{}}throw new Error("Native crypto module could not be used to get secure random number.")}function me(r){for(var t=r.words,n=r.sigBytes,e=[],s=0;s<n;s++){var i=t[s>>>2]>>>24-s%4*8&255;e.push((i>>>4).toString(16)),e.push((i&15).toString(16))}return e.join("")}var Ce=function(){function r(n,e){n=this.words=n||[],e!=null?this.sigBytes=e:this.sigBytes=n.length*4}var t=r.prototype;return t.random=function(e){for(var s=[],i=0;i<e;i+=4)s.push(pe());return new r(s,e)},t.toString=function(){return me(this)},r}();function c(r,t){r!=null&&this.fromString(r,t)}function U(){return new c(null)}var I,Ue=0xdeadbeefcafe,ne=(Ue&16777215)==15715070;function ye(r,t,n,e,s,i){for(;--i>=0;){var o=t*this[r++]+n[e]+s;s=Math.floor(o/67108864),n[e++]=o&67108863}return s}function Ae(r,t,n,e,s,i){for(var o=t&32767,a=t>>15;--i>=0;){var u=this[r]&32767,h=this[r++]>>15,f=a*u+h*o;u=o*u+((f&32767)<<15)+n[e]+(s&1073741823),s=(u>>>30)+(f>>>15)+a*h+(s>>>30),n[e++]=u&1073741823}return s}function De(r,t,n,e,s,i){for(var o=t&16383,a=t>>14;--i>=0;){var u=this[r]&16383,h=this[r++]>>14,f=a*u+h*o;u=o*u+((f&16383)<<14)+n[e]+s,s=(u>>28)+(f>>14)+a*h,n[e++]=u&268435455}return s}var ie=typeof navigator<"u";ie&&ne&&navigator.appName=="Microsoft Internet Explorer"?(c.prototype.am=Ae,I=30):ie&&ne&&navigator.appName!="Netscape"?(c.prototype.am=ye,I=26):(c.prototype.am=De,I=28);c.prototype.DB=I;c.prototype.DM=(1<<I)-1;c.prototype.DV=1<<I;var $=52;c.prototype.FV=Math.pow(2,$);c.prototype.F1=$-I;c.prototype.F2=2*I-$;var we="0123456789abcdefghijklmnopqrstuvwxyz",W=new Array,F,D;F="0".charCodeAt(0);for(D=0;D<=9;++D)W[F++]=D;F="a".charCodeAt(0);for(D=10;D<36;++D)W[F++]=D;F="A".charCodeAt(0);for(D=10;D<36;++D)W[F++]=D;function se(r){return we.charAt(r)}function Te(r,t){var n=W[r.charCodeAt(t)];return n??-1}function Ie(r){for(var t=this.t-1;t>=0;--t)r[t]=this[t];r.t=this.t,r.s=this.s}function Ee(r){this.t=1,this.s=r<0?-1:0,r>0?this[0]=r:r<-1?this[0]=r+this.DV:this.t=0}function Q(r){var t=U();return t.fromInt(r),t}function Pe(r,t){var n;if(t==16)n=4;else if(t==8)n=3;else if(t==2)n=1;else if(t==32)n=5;else if(t==4)n=2;else throw new Error("Only radix 2, 4, 8, 16, 32 are supported");this.t=0,this.s=0;for(var e=r.length,s=!1,i=0;--e>=0;){var o=Te(r,e);if(o<0){r.charAt(e)=="-"&&(s=!0);continue}s=!1,i==0?this[this.t++]=o:i+n>this.DB?(this[this.t-1]|=(o&(1<<this.DB-i)-1)<<i,this[this.t++]=o>>this.DB-i):this[this.t-1]|=o<<i,i+=n,i>=this.DB&&(i-=this.DB)}this.clamp(),s&&c.ZERO.subTo(this,this)}function Re(){for(var r=this.s&this.DM;this.t>0&&this[this.t-1]==r;)--this.t}function Fe(r){if(this.s<0)return"-"+this.negate().toString(r);var t;if(r==16)t=4;else if(r==8)t=3;else if(r==2)t=1;else if(r==32)t=5;else if(r==4)t=2;else throw new Error("Only radix 2, 4, 8, 16, 32 are supported");var n=(1<<t)-1,e,s=!1,i="",o=this.t,a=this.DB-o*this.DB%t;if(o-- >0)for(a<this.DB&&(e=this[o]>>a)>0&&(s=!0,i=se(e));o>=0;)a<t?(e=(this[o]&(1<<a)-1)<<t-a,e|=this[--o]>>(a+=this.DB-t)):(e=this[o]>>(a-=t)&n,a<=0&&(a+=this.DB,--o)),e>0&&(s=!0),s&&(i+=se(e));return s?i:"0"}function _e(){var r=U();return c.ZERO.subTo(this,r),r}function Ne(){return this.s<0?this.negate():this}function Me(r){var t=this.s-r.s;if(t!=0)return t;var n=this.t;if(t=n-r.t,t!=0)return this.s<0?-t:t;for(;--n>=0;)if((t=this[n]-r[n])!=0)return t;return 0}function ee(r){var t=1,n;return(n=r>>>16)!=0&&(r=n,t+=16),(n=r>>8)!=0&&(r=n,t+=8),(n=r>>4)!=0&&(r=n,t+=4),(n=r>>2)!=0&&(r=n,t+=2),(n=r>>1)!=0&&(r=n,t+=1),t}function Ke(){return this.t<=0?0:this.DB*(this.t-1)+ee(this[this.t-1]^this.s&this.DM)}function Be(r,t){var n;for(n=this.t-1;n>=0;--n)t[n+r]=this[n];for(n=r-1;n>=0;--n)t[n]=0;t.t=this.t+r,t.s=this.s}function Oe(r,t){for(var n=r;n<this.t;++n)t[n-r]=this[n];t.t=Math.max(this.t-r,0),t.s=this.s}function ke(r,t){var n=r%this.DB,e=this.DB-n,s=(1<<e)-1,i=Math.floor(r/this.DB),o=this.s<<n&this.DM,a;for(a=this.t-1;a>=0;--a)t[a+i+1]=this[a]>>e|o,o=(this[a]&s)<<n;for(a=i-1;a>=0;--a)t[a]=0;t[i]=o,t.t=this.t+i+1,t.s=this.s,t.clamp()}function xe(r,t){t.s=this.s;var n=Math.floor(r/this.DB);if(n>=this.t){t.t=0;return}var e=r%this.DB,s=this.DB-e,i=(1<<e)-1;t[0]=this[n]>>e;for(var o=n+1;o<this.t;++o)t[o-n-1]|=(this[o]&i)<<s,t[o-n]=this[o]>>e;e>0&&(t[this.t-n-1]|=(this.s&i)<<s),t.t=this.t-n,t.clamp()}function Ve(r,t){for(var n=0,e=0,s=Math.min(r.t,this.t);n<s;)e+=this[n]-r[n],t[n++]=e&this.DM,e>>=this.DB;if(r.t<this.t){for(e-=r.s;n<this.t;)e+=this[n],t[n++]=e&this.DM,e>>=this.DB;e+=this.s}else{for(e+=this.s;n<r.t;)e-=r[n],t[n++]=e&this.DM,e>>=this.DB;e-=r.s}t.s=e<0?-1:0,e<-1?t[n++]=this.DV+e:e>0&&(t[n++]=e),t.t=n,t.clamp()}function qe(r,t){var n=this.abs(),e=r.abs(),s=n.t;for(t.t=s+e.t;--s>=0;)t[s]=0;for(s=0;s<e.t;++s)t[s+n.t]=n.am(0,e[s],t,s,0,n.t);t.s=0,t.clamp(),this.s!=r.s&&c.ZERO.subTo(t,t)}function be(r){for(var t=this.abs(),n=r.t=2*t.t;--n>=0;)r[n]=0;for(n=0;n<t.t-1;++n){var e=t.am(n,t[n],r,2*n,0,1);(r[n+t.t]+=t.am(n+1,2*t[n],r,2*n+1,e,t.t-n-1))>=t.DV&&(r[n+t.t]-=t.DV,r[n+t.t+1]=1)}r.t>0&&(r[r.t-1]+=t.am(n,t[n],r,2*n,0,1)),r.s=0,r.clamp()}function He(r,t,n){var e=r.abs();if(!(e.t<=0)){var s=this.abs();if(s.t<e.t){t!=null&&t.fromInt(0),n!=null&&this.copyTo(n);return}n==null&&(n=U());var i=U(),o=this.s,a=r.s,u=this.DB-ee(e[e.t-1]);u>0?(e.lShiftTo(u,i),s.lShiftTo(u,n)):(e.copyTo(i),s.copyTo(n));var h=i.t,f=i[h-1];if(f!=0){var l=f*(1<<this.F1)+(h>1?i[h-2]>>this.F2:0),d=this.FV/l,g=(1<<this.F1)/l,S=1<<this.F2,v=n.t,C=v-h,p=t??U();for(i.dlShiftTo(C,p),n.compareTo(p)>=0&&(n[n.t++]=1,n.subTo(p,n)),c.ONE.dlShiftTo(h,p),p.subTo(i,i);i.t<h;)i[i.t++]=0;for(;--C>=0;){var y=n[--v]==f?this.DM:Math.floor(n[v]*d+(n[v-1]+S)*g);if((n[v]+=i.am(0,y,n,C,0,h))<y)for(i.dlShiftTo(C,p),n.subTo(p,n);n[v]<--y;)n.subTo(p,n)}t!=null&&(n.drShiftTo(h,t),o!=a&&c.ZERO.subTo(t,t)),n.t=h,n.clamp(),u>0&&n.rShiftTo(u,n),o<0&&c.ZERO.subTo(n,n)}}}function Le(r){var t=U();return this.abs().divRemTo(r,null,t),this.s<0&&t.compareTo(c.ZERO)>0&&r.subTo(t,t),t}function je(){if(this.t<1)return 0;var r=this[0];if(!(r&1))return 0;var t=r&3;return t=t*(2-(r&15)*t)&15,t=t*(2-(r&255)*t)&255,t=t*(2-((r&65535)*t&65535))&65535,t=t*(2-r*t%this.DV)%this.DV,t>0?this.DV-t:-t}function We(r){return this.compareTo(r)==0}function Je(r,t){for(var n=0,e=0,s=Math.min(r.t,this.t);n<s;)e+=this[n]+r[n],t[n++]=e&this.DM,e>>=this.DB;if(r.t<this.t){for(e+=r.s;n<this.t;)e+=this[n],t[n++]=e&this.DM,e>>=this.DB;e+=this.s}else{for(e+=this.s;n<r.t;)e+=r[n],t[n++]=e&this.DM,e>>=this.DB;e+=r.s}t.s=e<0?-1:0,e>0?t[n++]=e:e<-1&&(t[n++]=this.DV+e),t.t=n,t.clamp()}function Ge(r){var t=U();return this.addTo(r,t),t}function ze(r){var t=U();return this.subTo(r,t),t}function Ye(r){var t=U();return this.multiplyTo(r,t),t}function Ze(r){var t=U();return this.divRemTo(r,t,null),t}function _(r){this.m=r,this.mp=r.invDigit(),this.mpl=this.mp&32767,this.mph=this.mp>>15,this.um=(1<<r.DB-15)-1,this.mt2=2*r.t}function Xe(r){var t=U();return r.abs().dlShiftTo(this.m.t,t),t.divRemTo(this.m,null,t),r.s<0&&t.compareTo(c.ZERO)>0&&this.m.subTo(t,t),t}function $e(r){var t=U();return r.copyTo(t),this.reduce(t),t}function Qe(r){for(;r.t<=this.mt2;)r[r.t++]=0;for(var t=0;t<this.m.t;++t){var n=r[t]&32767,e=n*this.mpl+((n*this.mph+(r[t]>>15)*this.mpl&this.um)<<15)&r.DM;for(n=t+this.m.t,r[n]+=this.m.am(0,e,r,t,0,this.m.t);r[n]>=r.DV;)r[n]-=r.DV,r[++n]++}r.clamp(),r.drShiftTo(this.m.t,r),r.compareTo(this.m)>=0&&r.subTo(this.m,r)}function et(r,t){r.squareTo(t),this.reduce(t)}function tt(r,t,n){r.multiplyTo(t,n),this.reduce(n)}_.prototype.convert=Xe;_.prototype.revert=$e;_.prototype.reduce=Qe;_.prototype.mulTo=tt;_.prototype.sqrTo=et;function nt(r,t,n){var e=r.bitLength(),s,i=Q(1),o=new _(t);if(e<=0)return i;e<18?s=1:e<48?s=3:e<144?s=4:e<768?s=5:s=6;var a=new Array,u=3,h=s-1,f=(1<<s)-1;if(a[1]=o.convert(this),s>1){var l=U();for(o.sqrTo(a[1],l);u<=f;)a[u]=U(),o.mulTo(l,a[u-2],a[u]),u+=2}var d=r.t-1,g,S=!0,v=U(),C;for(e=ee(r[d])-1;d>=0;){for(e>=h?g=r[d]>>e-h&f:(g=(r[d]&(1<<e+1)-1)<<h-e,d>0&&(g|=r[d-1]>>this.DB+e-h)),u=s;!(g&1);)g>>=1,--u;if((e-=u)<0&&(e+=this.DB,--d),S)a[g].copyTo(i),S=!1;else{for(;u>1;)o.sqrTo(i,v),o.sqrTo(v,i),u-=2;u>0?o.sqrTo(i,v):(C=i,i=v,v=C),o.mulTo(v,a[g],i)}for(;d>=0&&!(r[d]&1<<e);)o.sqrTo(i,v),C=i,i=v,v=C,--e<0&&(e=this.DB-1,--d)}var p=o.revert(i);return n(null,p),p}c.prototype.copyTo=Ie;c.prototype.fromInt=Ee;c.prototype.fromString=Pe;c.prototype.clamp=Re;c.prototype.dlShiftTo=Be;c.prototype.drShiftTo=Oe;c.prototype.lShiftTo=ke;c.prototype.rShiftTo=xe;c.prototype.subTo=Ve;c.prototype.multiplyTo=qe;c.prototype.squareTo=be;c.prototype.divRemTo=He;c.prototype.invDigit=je;c.prototype.addTo=Je;c.prototype.toString=Fe;c.prototype.negate=_e;c.prototype.abs=Ne;c.prototype.compareTo=Me;c.prototype.bitLength=Ke;c.prototype.mod=Le;c.prototype.equals=We;c.prototype.add=Ge;c.prototype.subtract=ze;c.prototype.multiply=Ye;c.prototype.divide=Ze;c.prototype.modPow=nt;c.ZERO=Q(0);c.ONE=Q(1);/*!
 * Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
 * SPDX-License-Identifier: Apache-2.0
 */function G(r){return m.Buffer.from(new Ce().random(r).toString(),"hex")}var it=/^[89a-f]/i,st="FFFFFFFFFFFFFFFFC90FDAA22168C234C4C6628B80DC1CD129024E088A67CC74020BBEA63B139B22514A08798E3404DDEF9519B3CD3A431B302B0A6DF25F14374FE1356D6D51C245E485B576625E7EC6F44C42E9A637ED6B0BFF5CB6F406B7EDEE386BFB5A899FA5AE9F24117C4B1FE649286651ECE45B3DC2007CB8A163BF0598DA48361C55D39A69163FA8FD24CF5F83655D23DCA3AD961C62F356208552BB9ED529077096966D670C354E4ABC9804F1746C08CA18217C32905E462E36CE3BE39E772C180E86039B2783A2EC07A28FB5C55DF06F4C52C9DE2BCBF6955817183995497CEA956AE515D2261898FA051015728E5A8AAAC42DAD33170D04507A33A85521ABDF1CBA64ECFB850458DBEF0A8AEA71575D060C7DB3970F85A6E1E4C7ABF5AE8CDB0933D71E8C94E04A25619DCEE3D2261AD2EE6BF12FFA06D98A0864D87602733EC86A64521F2B18177B200CBBE117577A615D6C770988C0BAD946E208E24FA074E5AB3143DB5BFCE0FD108E4B82D120A93AD2CAFFFFFFFFFFFFFFFF",rt="userAttributes.",P=function(){function r(n){this.N=new c(st,16),this.g=new c("2",16),this.k=new c(this.hexHash(""+this.padHex(this.N)+this.padHex(this.g)),16),this.smallAValue=this.generateRandomSmallA(),this.getLargeAValue(function(){}),this.infoBits=m.Buffer.from("Caldera Derived Key","utf8"),this.poolName=n}var t=r.prototype;return t.getSmallAValue=function(){return this.smallAValue},t.getLargeAValue=function(e){var s=this;this.largeAValue?e(null,this.largeAValue):this.calculateA(this.smallAValue,function(i,o){i&&e(i,null),s.largeAValue=o,e(null,s.largeAValue)})},t.generateRandomSmallA=function(){var e=G(128).toString("hex"),s=new c(e,16);return s},t.generateRandomString=function(){return G(40).toString("base64")},t.getRandomPassword=function(){return this.randomPassword},t.getSaltDevices=function(){return this.SaltToHashDevices},t.getVerifierDevices=function(){return this.verifierDevices},t.generateHashDevice=function(e,s,i){var o=this;this.randomPassword=this.generateRandomString();var a=""+e+s+":"+this.randomPassword,u=this.hash(a),h=G(16).toString("hex");this.SaltToHashDevices=this.padHex(new c(h,16)),this.g.modPow(new c(this.hexHash(this.SaltToHashDevices+u),16),this.N,function(f,l){f&&i(f,null),o.verifierDevices=o.padHex(l),i(null,null)})},t.calculateA=function(e,s){var i=this;this.g.modPow(e,this.N,function(o,a){o&&s(o,null),a.mod(i.N).equals(c.ZERO)&&s(new Error("Illegal paramater. A mod N cannot be 0."),null),s(null,a)})},t.calculateU=function(e,s){this.UHexHash=this.hexHash(this.padHex(e)+this.padHex(s));var i=new c(this.UHexHash,16);return i},t.hash=function(e){var s=new N.Sha256;s.update(e);var i=s.digestSync(),o=m.Buffer.from(i).toString("hex");return new Array(64-o.length).join("0")+o},t.hexHash=function(e){return this.hash(m.Buffer.from(e,"hex"))},t.computehkdf=function(e,s){var i=m.Buffer.concat([this.infoBits,m.Buffer.from(String.fromCharCode(1),"utf8")]),o=new N.Sha256(s);o.update(e);var a=o.digestSync(),u=new N.Sha256(a);u.update(i);var h=u.digestSync(),f=h,l=f.slice(0,16);return l},t.getPasswordAuthenticationKey=function(e,s,i,o,a){var u=this;if(i.mod(this.N).equals(c.ZERO))throw new Error("B cannot be zero.");if(this.UValue=this.calculateU(this.largeAValue,i),this.UValue.equals(c.ZERO))throw new Error("U cannot be zero.");var h=""+this.poolName+e+":"+s,f=this.hash(h),l=new c(this.hexHash(this.padHex(o)+f),16);this.calculateS(l,i,function(d,g){d&&a(d,null);var S=u.computehkdf(m.Buffer.from(u.padHex(g),"hex"),m.Buffer.from(u.padHex(u.UValue),"hex"));a(null,S)})},t.calculateS=function(e,s,i){var o=this;this.g.modPow(e,this.N,function(a,u){a&&i(a,null);var h=s.subtract(o.k.multiply(u));h.modPow(o.smallAValue.add(o.UValue.multiply(e)),o.N,function(f,l){f&&i(f,null),i(null,l.mod(o.N))})})},t.getNewPasswordRequiredChallengeUserAttributePrefix=function(){return rt},t.padHex=function(e){if(!(e instanceof c))throw new Error("Not a BigInteger");var s=e.compareTo(c.ZERO)<0,i=e.abs().toString(16);if(i=i.length%2!==0?"0"+i:i,i=it.test(i)?"00"+i:i,s){var o=i.split("").map(function(u){var h=~parseInt(u,16)&15;return"0123456789ABCDEF".charAt(h)}).join(""),a=new c(o,16).add(c.ONE);i=a.toString(16),i.toUpperCase().startsWith("FF8")&&(i=i.substring(2))}return i},r}();/*!
 * Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
 * SPDX-License-Identifier: Apache-2.0
 */var le=function(){function r(n){this.jwtToken=n||"",this.payload=this.decodePayload()}var t=r.prototype;return t.getJwtToken=function(){return this.jwtToken},t.getExpiration=function(){return this.payload.exp},t.getIssuedAt=function(){return this.payload.iat},t.decodePayload=function(){var e=this.jwtToken.split(".")[1];try{return JSON.parse(m.Buffer.from(e,"base64").toString("utf8"))}catch{return{}}},r}();function ot(r,t){r.prototype=Object.create(t.prototype),r.prototype.constructor=r,z(r,t)}function z(r,t){return z=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,s){return e.__proto__=s,e},z(r,t)}var re=function(r){ot(t,r);function t(n){var e=n===void 0?{}:n,s=e.AccessToken;return r.call(this,s||"")||this}return t}(le);function at(r,t){r.prototype=Object.create(t.prototype),r.prototype.constructor=r,Y(r,t)}function Y(r,t){return Y=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,s){return e.__proto__=s,e},Y(r,t)}var oe=function(r){at(t,r);function t(n){var e=n===void 0?{}:n,s=e.IdToken;return r.call(this,s||"")||this}return t}(le);/*!
 * Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
 * SPDX-License-Identifier: Apache-2.0
 */var ae=function(){function r(n){var e=n===void 0?{}:n,s=e.RefreshToken;this.token=s||""}var t=r.prototype;return t.getToken=function(){return this.token},r}(),ut="5.0.4";/*!
 * Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
 * SPDX-License-Identifier: Apache-2.0
 */var ht="aws-amplify/"+ut,de={userAgent:ht,isReactNative:typeof navigator<"u"&&navigator.product==="ReactNative"},ft=function(){return de.userAgent};/*!
 * Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
 * SPDX-License-Identifier: Apache-2.0
 */var ue=function(){function r(n){var e=n===void 0?{}:n,s=e.IdToken,i=e.RefreshToken,o=e.AccessToken,a=e.ClockDrift;if(o==null||s==null)throw new Error("Id token and Access Token must be present.");this.idToken=s,this.refreshToken=i,this.accessToken=o,this.clockDrift=a===void 0?this.calculateClockDrift():a}var t=r.prototype;return t.getIdToken=function(){return this.idToken},t.getRefreshToken=function(){return this.refreshToken},t.getAccessToken=function(){return this.accessToken},t.getClockDrift=function(){return this.clockDrift},t.calculateClockDrift=function(){var e=Math.floor(new Date/1e3),s=Math.min(this.accessToken.getIssuedAt(),this.idToken.getIssuedAt());return e-s},t.isValid=function(){var e=Math.floor(new Date/1e3),s=e-this.clockDrift;return s<this.accessToken.getExpiration()&&s<this.idToken.getExpiration()},r}();/*!
 * Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
 * SPDX-License-Identifier: Apache-2.0
 */var ct=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],lt=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],he=function(){function r(){}var t=r.prototype;return t.getNowString=function(){var e=new Date,s=lt[e.getUTCDay()],i=ct[e.getUTCMonth()],o=e.getUTCDate(),a=e.getUTCHours();a<10&&(a="0"+a);var u=e.getUTCMinutes();u<10&&(u="0"+u);var h=e.getUTCSeconds();h<10&&(h="0"+h);var f=e.getUTCFullYear(),l=s+" "+i+" "+o+" "+a+":"+u+":"+h+" UTC "+f;return l},r}();/*!
 * Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
 * SPDX-License-Identifier: Apache-2.0
 */var dt=function(){function r(n){var e=n===void 0?{}:n,s=e.Name,i=e.Value;this.Name=s||"",this.Value=i||""}var t=r.prototype;return t.getValue=function(){return this.Value},t.setValue=function(e){return this.Value=e,this},t.getName=function(){return this.Name},t.setName=function(e){return this.Name=e,this},t.toString=function(){return JSON.stringify(this)},t.toJSON=function(){return{Name:this.Name,Value:this.Value}},r}();/*!
 * Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
 * SPDX-License-Identifier: Apache-2.0
 */var E={},gt=function(){function r(){}return r.setItem=function(n,e){return E[n]=e,E[n]},r.getItem=function(n){return Object.prototype.hasOwnProperty.call(E,n)?E[n]:void 0},r.removeItem=function(n){return delete E[n]},r.clear=function(){return E={},E},r}(),ge=function(){function r(){try{this.storageWindow=window.localStorage,this.storageWindow.setItem("aws.cognito.test-ls",1),this.storageWindow.removeItem("aws.cognito.test-ls")}catch{this.storageWindow=gt}}var t=r.prototype;return t.getStorage=function(){return this.storageWindow},r}();/*!
 * Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
 * SPDX-License-Identifier: Apache-2.0
 */var vt=typeof navigator<"u",fe=vt?de.isReactNative?"react-native":navigator.userAgent:"nodejs",ce=function(){function r(n){if(n==null||n.Username==null||n.Pool==null)throw new Error("Username and Pool information are required.");this.username=n.Username||"",this.pool=n.Pool,this.Session=null,this.client=n.Pool.client,this.signInUserSession=null,this.authenticationFlowType="USER_SRP_AUTH",this.storage=n.Storage||new ge().getStorage(),this.keyPrefix="CognitoIdentityServiceProvider."+this.pool.getClientId(),this.userDataKey=this.keyPrefix+"."+this.username+".userData"}var t=r.prototype;return t.setSignInUserSession=function(e){this.clearCachedUserData(),this.signInUserSession=e,this.cacheTokens()},t.getSignInUserSession=function(){return this.signInUserSession},t.getUsername=function(){return this.username},t.getAuthenticationFlowType=function(){return this.authenticationFlowType},t.setAuthenticationFlowType=function(e){this.authenticationFlowType=e},t.initiateAuth=function(e,s){var i=this,o=e.getAuthParameters();o.USERNAME=this.username;var a=Object.keys(e.getValidationData()).length!==0?e.getValidationData():e.getClientMetadata(),u={AuthFlow:"CUSTOM_AUTH",ClientId:this.pool.getClientId(),AuthParameters:o,ClientMetadata:a};this.getUserContextData()&&(u.UserContextData=this.getUserContextData()),this.client.request("InitiateAuth",u,function(h,f){if(h)return s.onFailure(h);var l=f.ChallengeName,d=f.ChallengeParameters;return l==="CUSTOM_CHALLENGE"?(i.Session=f.Session,s.customChallenge(d)):(i.signInUserSession=i.getCognitoUserSession(f.AuthenticationResult),i.cacheTokens(),s.onSuccess(i.signInUserSession))})},t.authenticateUser=function(e,s){return this.authenticationFlowType==="USER_PASSWORD_AUTH"?this.authenticateUserPlainUsernamePassword(e,s):this.authenticationFlowType==="USER_SRP_AUTH"||this.authenticationFlowType==="CUSTOM_AUTH"?this.authenticateUserDefaultAuth(e,s):s.onFailure(new Error("Authentication flow type is invalid."))},t.authenticateUserDefaultAuth=function(e,s){var i=this,o=new P(this.pool.getUserPoolName()),a=new he,u,h,f={};this.deviceKey!=null&&(f.DEVICE_KEY=this.deviceKey),f.USERNAME=this.username,o.getLargeAValue(function(l,d){l&&s.onFailure(l),f.SRP_A=d.toString(16),i.authenticationFlowType==="CUSTOM_AUTH"&&(f.CHALLENGE_NAME="SRP_A");var g=Object.keys(e.getValidationData()).length!==0?e.getValidationData():e.getClientMetadata(),S={AuthFlow:i.authenticationFlowType,ClientId:i.pool.getClientId(),AuthParameters:f,ClientMetadata:g};i.getUserContextData(i.username)&&(S.UserContextData=i.getUserContextData(i.username)),i.client.request("InitiateAuth",S,function(v,C){if(v)return s.onFailure(v);var p=C.ChallengeParameters;i.username=p.USER_ID_FOR_SRP,i.userDataKey=i.keyPrefix+"."+i.username+".userData",u=new c(p.SRP_B,16),h=new c(p.SALT,16),i.getCachedDeviceKeyAndPassword(),o.getPasswordAuthenticationKey(i.username,e.getPassword(),u,h,function(y,K){y&&s.onFailure(y);var B=a.getNowString(),O=m.Buffer.concat([m.Buffer.from(i.pool.getUserPoolName(),"utf8"),m.Buffer.from(i.username,"utf8"),m.Buffer.from(p.SECRET_BLOCK,"base64"),m.Buffer.from(B,"utf8")]),k=new N.Sha256(K);k.update(O);var J=k.digestSync(),T=m.Buffer.from(J).toString("base64"),w={};w.USERNAME=i.username,w.PASSWORD_CLAIM_SECRET_BLOCK=p.SECRET_BLOCK,w.TIMESTAMP=B,w.PASSWORD_CLAIM_SIGNATURE=T,i.deviceKey!=null&&(w.DEVICE_KEY=i.deviceKey);var x=function q(b,te){return i.client.request("RespondToAuthChallenge",b,function(H,Se){return H&&H.code==="ResourceNotFoundException"&&H.message.toLowerCase().indexOf("device")!==-1?(w.DEVICE_KEY=null,i.deviceKey=null,i.randomPassword=null,i.deviceGroupKey=null,i.clearCachedDeviceKeyAndPassword(),q(b,te)):te(H,Se)})},V={ChallengeName:"PASSWORD_VERIFIER",ClientId:i.pool.getClientId(),ChallengeResponses:w,Session:C.Session,ClientMetadata:g};i.getUserContextData()&&(V.UserContextData=i.getUserContextData()),x(V,function(q,b){return q?s.onFailure(q):i.authenticateUserInternal(b,o,s)})})})})},t.authenticateUserPlainUsernamePassword=function(e,s){var i=this,o={};if(o.USERNAME=this.username,o.PASSWORD=e.getPassword(),!o.PASSWORD){s.onFailure(new Error("PASSWORD parameter is required"));return}var a=new P(this.pool.getUserPoolName());this.getCachedDeviceKeyAndPassword(),this.deviceKey!=null&&(o.DEVICE_KEY=this.deviceKey);var u=Object.keys(e.getValidationData()).length!==0?e.getValidationData():e.getClientMetadata(),h={AuthFlow:"USER_PASSWORD_AUTH",ClientId:this.pool.getClientId(),AuthParameters:o,ClientMetadata:u};this.getUserContextData(this.username)&&(h.UserContextData=this.getUserContextData(this.username)),this.client.request("InitiateAuth",h,function(f,l){return f?s.onFailure(f):i.authenticateUserInternal(l,a,s)})},t.authenticateUserInternal=function(e,s,i){var o=this,a=e.ChallengeName,u=e.ChallengeParameters;if(a==="SMS_MFA")return this.Session=e.Session,i.mfaRequired(a,u);if(a==="SELECT_MFA_TYPE")return this.Session=e.Session,i.selectMFAType(a,u);if(a==="MFA_SETUP")return this.Session=e.Session,i.mfaSetup(a,u);if(a==="SOFTWARE_TOKEN_MFA")return this.Session=e.Session,i.totpRequired(a,u);if(a==="CUSTOM_CHALLENGE")return this.Session=e.Session,i.customChallenge(u);if(a==="NEW_PASSWORD_REQUIRED"){this.Session=e.Session;var h=null,f=null,l=[],d=s.getNewPasswordRequiredChallengeUserAttributePrefix();if(u&&(h=JSON.parse(e.ChallengeParameters.userAttributes),f=JSON.parse(e.ChallengeParameters.requiredAttributes)),f)for(var g=0;g<f.length;g++)l[g]=f[g].substr(d.length);return i.newPasswordRequired(h,l)}if(a==="DEVICE_SRP_AUTH"){this.Session=e.Session,this.getDeviceResponse(i);return}this.signInUserSession=this.getCognitoUserSession(e.AuthenticationResult),this.challengeName=a,this.cacheTokens();var S=e.AuthenticationResult.NewDeviceMetadata;if(S==null)return i.onSuccess(this.signInUserSession);s.generateHashDevice(e.AuthenticationResult.NewDeviceMetadata.DeviceGroupKey,e.AuthenticationResult.NewDeviceMetadata.DeviceKey,function(v){if(v)return i.onFailure(v);var C={Salt:m.Buffer.from(s.getSaltDevices(),"hex").toString("base64"),PasswordVerifier:m.Buffer.from(s.getVerifierDevices(),"hex").toString("base64")};o.verifierDevices=C.PasswordVerifier,o.deviceGroupKey=S.DeviceGroupKey,o.randomPassword=s.getRandomPassword(),o.client.request("ConfirmDevice",{DeviceKey:S.DeviceKey,AccessToken:o.signInUserSession.getAccessToken().getJwtToken(),DeviceSecretVerifierConfig:C,DeviceName:fe},function(p,y){return p?i.onFailure(p):(o.deviceKey=e.AuthenticationResult.NewDeviceMetadata.DeviceKey,o.cacheDeviceKeyAndPassword(),y.UserConfirmationNecessary===!0?i.onSuccess(o.signInUserSession,y.UserConfirmationNecessary):i.onSuccess(o.signInUserSession))})})},t.completeNewPasswordChallenge=function(e,s,i,o){var a=this;if(!e)return i.onFailure(new Error("New password is required."));var u=new P(this.pool.getUserPoolName()),h=u.getNewPasswordRequiredChallengeUserAttributePrefix(),f={};s&&Object.keys(s).forEach(function(d){f[h+d]=s[d]}),f.NEW_PASSWORD=e,f.USERNAME=this.username;var l={ChallengeName:"NEW_PASSWORD_REQUIRED",ClientId:this.pool.getClientId(),ChallengeResponses:f,Session:this.Session,ClientMetadata:o};this.getUserContextData()&&(l.UserContextData=this.getUserContextData()),this.client.request("RespondToAuthChallenge",l,function(d,g){return d?i.onFailure(d):a.authenticateUserInternal(g,u,i)})},t.getDeviceResponse=function(e,s){var i=this,o=new P(this.deviceGroupKey),a=new he,u={};u.USERNAME=this.username,u.DEVICE_KEY=this.deviceKey,o.getLargeAValue(function(h,f){h&&e.onFailure(h),u.SRP_A=f.toString(16);var l={ChallengeName:"DEVICE_SRP_AUTH",ClientId:i.pool.getClientId(),ChallengeResponses:u,ClientMetadata:s,Session:i.Session};i.getUserContextData()&&(l.UserContextData=i.getUserContextData()),i.client.request("RespondToAuthChallenge",l,function(d,g){if(d)return e.onFailure(d);var S=g.ChallengeParameters,v=new c(S.SRP_B,16),C=new c(S.SALT,16);o.getPasswordAuthenticationKey(i.deviceKey,i.randomPassword,v,C,function(p,y){if(p)return e.onFailure(p);var K=a.getNowString(),B=m.Buffer.concat([m.Buffer.from(i.deviceGroupKey,"utf8"),m.Buffer.from(i.deviceKey,"utf8"),m.Buffer.from(S.SECRET_BLOCK,"base64"),m.Buffer.from(K,"utf8")]),O=new N.Sha256(y);O.update(B);var k=O.digestSync(),J=m.Buffer.from(k).toString("base64"),T={};T.USERNAME=i.username,T.PASSWORD_CLAIM_SECRET_BLOCK=S.SECRET_BLOCK,T.TIMESTAMP=K,T.PASSWORD_CLAIM_SIGNATURE=J,T.DEVICE_KEY=i.deviceKey;var w={ChallengeName:"DEVICE_PASSWORD_VERIFIER",ClientId:i.pool.getClientId(),ChallengeResponses:T,Session:g.Session};i.getUserContextData()&&(w.UserContextData=i.getUserContextData()),i.client.request("RespondToAuthChallenge",w,function(x,V){return x?e.onFailure(x):(i.signInUserSession=i.getCognitoUserSession(V.AuthenticationResult),i.cacheTokens(),e.onSuccess(i.signInUserSession))})})})})},t.confirmRegistration=function(e,s,i,o){var a={ClientId:this.pool.getClientId(),ConfirmationCode:e,Username:this.username,ForceAliasCreation:s,ClientMetadata:o};this.getUserContextData()&&(a.UserContextData=this.getUserContextData()),this.client.request("ConfirmSignUp",a,function(u){return u?i(u,null):i(null,"SUCCESS")})},t.sendCustomChallengeAnswer=function(e,s,i){var o=this,a={};a.USERNAME=this.username,a.ANSWER=e;var u=new P(this.pool.getUserPoolName());this.getCachedDeviceKeyAndPassword(),this.deviceKey!=null&&(a.DEVICE_KEY=this.deviceKey);var h={ChallengeName:"CUSTOM_CHALLENGE",ChallengeResponses:a,ClientId:this.pool.getClientId(),Session:this.Session,ClientMetadata:i};this.getUserContextData()&&(h.UserContextData=this.getUserContextData()),this.client.request("RespondToAuthChallenge",h,function(f,l){return f?s.onFailure(f):o.authenticateUserInternal(l,u,s)})},t.sendMFACode=function(e,s,i,o){var a=this,u={};u.USERNAME=this.username,u.SMS_MFA_CODE=e;var h=i||"SMS_MFA";h==="SOFTWARE_TOKEN_MFA"&&(u.SOFTWARE_TOKEN_MFA_CODE=e),this.deviceKey!=null&&(u.DEVICE_KEY=this.deviceKey);var f={ChallengeName:h,ChallengeResponses:u,ClientId:this.pool.getClientId(),Session:this.Session,ClientMetadata:o};this.getUserContextData()&&(f.UserContextData=this.getUserContextData()),this.client.request("RespondToAuthChallenge",f,function(l,d){if(l)return s.onFailure(l);var g=d.ChallengeName;if(g==="DEVICE_SRP_AUTH"){a.getDeviceResponse(s);return}if(a.signInUserSession=a.getCognitoUserSession(d.AuthenticationResult),a.cacheTokens(),d.AuthenticationResult.NewDeviceMetadata==null)return s.onSuccess(a.signInUserSession);var S=new P(a.pool.getUserPoolName());S.generateHashDevice(d.AuthenticationResult.NewDeviceMetadata.DeviceGroupKey,d.AuthenticationResult.NewDeviceMetadata.DeviceKey,function(v){if(v)return s.onFailure(v);var C={Salt:m.Buffer.from(S.getSaltDevices(),"hex").toString("base64"),PasswordVerifier:m.Buffer.from(S.getVerifierDevices(),"hex").toString("base64")};a.verifierDevices=C.PasswordVerifier,a.deviceGroupKey=d.AuthenticationResult.NewDeviceMetadata.DeviceGroupKey,a.randomPassword=S.getRandomPassword(),a.client.request("ConfirmDevice",{DeviceKey:d.AuthenticationResult.NewDeviceMetadata.DeviceKey,AccessToken:a.signInUserSession.getAccessToken().getJwtToken(),DeviceSecretVerifierConfig:C,DeviceName:fe},function(p,y){return p?s.onFailure(p):(a.deviceKey=d.AuthenticationResult.NewDeviceMetadata.DeviceKey,a.cacheDeviceKeyAndPassword(),y.UserConfirmationNecessary===!0?s.onSuccess(a.signInUserSession,y.UserConfirmationNecessary):s.onSuccess(a.signInUserSession))})})})},t.changePassword=function(e,s,i,o){if(!(this.signInUserSession!=null&&this.signInUserSession.isValid()))return i(new Error("User is not authenticated"),null);this.client.request("ChangePassword",{PreviousPassword:e,ProposedPassword:s,AccessToken:this.signInUserSession.getAccessToken().getJwtToken(),ClientMetadata:o},function(a){return a?i(a,null):i(null,"SUCCESS")})},t.enableMFA=function(e){if(this.signInUserSession==null||!this.signInUserSession.isValid())return e(new Error("User is not authenticated"),null);var s=[],i={DeliveryMedium:"SMS",AttributeName:"phone_number"};s.push(i),this.client.request("SetUserSettings",{MFAOptions:s,AccessToken:this.signInUserSession.getAccessToken().getJwtToken()},function(o){return o?e(o,null):e(null,"SUCCESS")})},t.setUserMfaPreference=function(e,s,i){if(this.signInUserSession==null||!this.signInUserSession.isValid())return i(new Error("User is not authenticated"),null);this.client.request("SetUserMFAPreference",{SMSMfaSettings:e,SoftwareTokenMfaSettings:s,AccessToken:this.signInUserSession.getAccessToken().getJwtToken()},function(o){return o?i(o,null):i(null,"SUCCESS")})},t.disableMFA=function(e){if(this.signInUserSession==null||!this.signInUserSession.isValid())return e(new Error("User is not authenticated"),null);var s=[];this.client.request("SetUserSettings",{MFAOptions:s,AccessToken:this.signInUserSession.getAccessToken().getJwtToken()},function(i){return i?e(i,null):e(null,"SUCCESS")})},t.deleteUser=function(e,s){var i=this;if(this.signInUserSession==null||!this.signInUserSession.isValid())return e(new Error("User is not authenticated"),null);this.client.request("DeleteUser",{AccessToken:this.signInUserSession.getAccessToken().getJwtToken(),ClientMetadata:s},function(o){return o?e(o,null):(i.clearCachedUser(),e(null,"SUCCESS"))})},t.updateAttributes=function(e,s,i){var o=this;if(this.signInUserSession==null||!this.signInUserSession.isValid())return s(new Error("User is not authenticated"),null);this.client.request("UpdateUserAttributes",{AccessToken:this.signInUserSession.getAccessToken().getJwtToken(),UserAttributes:e,ClientMetadata:i},function(a,u){return a?s(a,null):o.getUserData(function(){return s(null,"SUCCESS",u)},{bypassCache:!0})})},t.getUserAttributes=function(e){if(!(this.signInUserSession!=null&&this.signInUserSession.isValid()))return e(new Error("User is not authenticated"),null);this.client.request("GetUser",{AccessToken:this.signInUserSession.getAccessToken().getJwtToken()},function(s,i){if(s)return e(s,null);for(var o=[],a=0;a<i.UserAttributes.length;a++){var u={Name:i.UserAttributes[a].Name,Value:i.UserAttributes[a].Value},h=new dt(u);o.push(h)}return e(null,o)})},t.getMFAOptions=function(e){if(!(this.signInUserSession!=null&&this.signInUserSession.isValid()))return e(new Error("User is not authenticated"),null);this.client.request("GetUser",{AccessToken:this.signInUserSession.getAccessToken().getJwtToken()},function(s,i){return s?e(s,null):e(null,i.MFAOptions)})},t.createGetUserRequest=function(){return this.client.promisifyRequest("GetUser",{AccessToken:this.signInUserSession.getAccessToken().getJwtToken()})},t.refreshSessionIfPossible=function(e){var s=this;return e===void 0&&(e={}),new Promise(function(i){var o=s.signInUserSession.getRefreshToken();o&&o.getToken()?s.refreshSession(o,i,e.clientMetadata):i()})},t.getUserData=function(e,s){var i=this;if(!(this.signInUserSession!=null&&this.signInUserSession.isValid()))return this.clearCachedUserData(),e(new Error("User is not authenticated"),null);var o=this.getUserDataFromCache();if(!o){this.fetchUserData().then(function(a){e(null,a)}).catch(e);return}if(this.isFetchUserDataAndTokenRequired(s)){this.fetchUserData().then(function(a){return i.refreshSessionIfPossible(s).then(function(){return a})}).then(function(a){return e(null,a)}).catch(e);return}try{e(null,JSON.parse(o));return}catch(a){this.clearCachedUserData(),e(a,null);return}},t.getUserDataFromCache=function(){var e=this.storage.getItem(this.userDataKey);return e},t.isFetchUserDataAndTokenRequired=function(e){var s=e||{},i=s.bypassCache,o=i===void 0?!1:i;return o},t.fetchUserData=function(){var e=this;return this.createGetUserRequest().then(function(s){return e.cacheUserData(s),s})},t.deleteAttributes=function(e,s){var i=this;if(!(this.signInUserSession!=null&&this.signInUserSession.isValid()))return s(new Error("User is not authenticated"),null);this.client.request("DeleteUserAttributes",{UserAttributeNames:e,AccessToken:this.signInUserSession.getAccessToken().getJwtToken()},function(o){return o?s(o,null):i.getUserData(function(){return s(null,"SUCCESS")},{bypassCache:!0})})},t.resendConfirmationCode=function(e,s){var i={ClientId:this.pool.getClientId(),Username:this.username,ClientMetadata:s};this.client.request("ResendConfirmationCode",i,function(o,a){return o?e(o,null):e(null,a)})},t.getSession=function(e,s){if(s===void 0&&(s={}),this.username==null)return e(new Error("Username is null. Cannot retrieve a new session"),null);if(this.signInUserSession!=null&&this.signInUserSession.isValid())return e(null,this.signInUserSession);var i="CognitoIdentityServiceProvider."+this.pool.getClientId()+"."+this.username,o=i+".idToken",a=i+".accessToken",u=i+".refreshToken",h=i+".clockDrift";if(this.storage.getItem(o)){var f=new oe({IdToken:this.storage.getItem(o)}),l=new re({AccessToken:this.storage.getItem(a)}),d=new ae({RefreshToken:this.storage.getItem(u)}),g=parseInt(this.storage.getItem(h),0)||0,S={IdToken:f,AccessToken:l,RefreshToken:d,ClockDrift:g},v=new ue(S);if(v.isValid())return this.signInUserSession=v,e(null,this.signInUserSession);if(!d.getToken())return e(new Error("Cannot retrieve a new session. Please authenticate."),null);this.refreshSession(d,e,s.clientMetadata)}else e(new Error("Local storage is missing an ID Token, Please authenticate"),null)},t.refreshSession=function(e,s,i){var o=this,a=this.pool.wrapRefreshSessionCallback?this.pool.wrapRefreshSessionCallback(s):s,u={};u.REFRESH_TOKEN=e.getToken();var h="CognitoIdentityServiceProvider."+this.pool.getClientId(),f=h+".LastAuthUser";if(this.storage.getItem(f)){this.username=this.storage.getItem(f);var l=h+"."+this.username+".deviceKey";this.deviceKey=this.storage.getItem(l),u.DEVICE_KEY=this.deviceKey}var d={ClientId:this.pool.getClientId(),AuthFlow:"REFRESH_TOKEN_AUTH",AuthParameters:u,ClientMetadata:i};this.getUserContextData()&&(d.UserContextData=this.getUserContextData()),this.client.request("InitiateAuth",d,function(g,S){if(g)return g.code==="NotAuthorizedException"&&o.clearCachedUser(),a(g,null);if(S){var v=S.AuthenticationResult;return Object.prototype.hasOwnProperty.call(v,"RefreshToken")||(v.RefreshToken=e.getToken()),o.signInUserSession=o.getCognitoUserSession(v),o.cacheTokens(),a(null,o.signInUserSession)}})},t.cacheTokens=function(){var e="CognitoIdentityServiceProvider."+this.pool.getClientId(),s=e+"."+this.username+".idToken",i=e+"."+this.username+".accessToken",o=e+"."+this.username+".refreshToken",a=e+"."+this.username+".clockDrift",u=e+".LastAuthUser";this.storage.setItem(s,this.signInUserSession.getIdToken().getJwtToken()),this.storage.setItem(i,this.signInUserSession.getAccessToken().getJwtToken()),this.storage.setItem(o,this.signInUserSession.getRefreshToken().getToken()),this.storage.setItem(a,""+this.signInUserSession.getClockDrift()),this.storage.setItem(u,this.username)},t.cacheUserData=function(e){this.storage.setItem(this.userDataKey,JSON.stringify(e))},t.clearCachedUserData=function(){this.storage.removeItem(this.userDataKey)},t.clearCachedUser=function(){this.clearCachedTokens(),this.clearCachedUserData()},t.cacheDeviceKeyAndPassword=function(){var e="CognitoIdentityServiceProvider."+this.pool.getClientId()+"."+this.username,s=e+".deviceKey",i=e+".randomPasswordKey",o=e+".deviceGroupKey";this.storage.setItem(s,this.deviceKey),this.storage.setItem(i,this.randomPassword),this.storage.setItem(o,this.deviceGroupKey)},t.getCachedDeviceKeyAndPassword=function(){var e="CognitoIdentityServiceProvider."+this.pool.getClientId()+"."+this.username,s=e+".deviceKey",i=e+".randomPasswordKey",o=e+".deviceGroupKey";this.storage.getItem(s)&&(this.deviceKey=this.storage.getItem(s),this.randomPassword=this.storage.getItem(i),this.deviceGroupKey=this.storage.getItem(o))},t.clearCachedDeviceKeyAndPassword=function(){var e="CognitoIdentityServiceProvider."+this.pool.getClientId()+"."+this.username,s=e+".deviceKey",i=e+".randomPasswordKey",o=e+".deviceGroupKey";this.storage.removeItem(s),this.storage.removeItem(i),this.storage.removeItem(o)},t.clearCachedTokens=function(){var e="CognitoIdentityServiceProvider."+this.pool.getClientId(),s=e+"."+this.username+".idToken",i=e+"."+this.username+".accessToken",o=e+"."+this.username+".refreshToken",a=e+".LastAuthUser",u=e+"."+this.username+".clockDrift";this.storage.removeItem(s),this.storage.removeItem(i),this.storage.removeItem(o),this.storage.removeItem(a),this.storage.removeItem(u)},t.getCognitoUserSession=function(e){var s=new oe(e),i=new re(e),o=new ae(e),a={IdToken:s,AccessToken:i,RefreshToken:o};return new ue(a)},t.forgotPassword=function(e,s){var i={ClientId:this.pool.getClientId(),Username:this.username,ClientMetadata:s};this.getUserContextData()&&(i.UserContextData=this.getUserContextData()),this.client.request("ForgotPassword",i,function(o,a){return o?e.onFailure(o):typeof e.inputVerificationCode=="function"?e.inputVerificationCode(a):e.onSuccess(a)})},t.confirmPassword=function(e,s,i,o){var a={ClientId:this.pool.getClientId(),Username:this.username,ConfirmationCode:e,Password:s,ClientMetadata:o};this.getUserContextData()&&(a.UserContextData=this.getUserContextData()),this.client.request("ConfirmForgotPassword",a,function(u){return u?i.onFailure(u):i.onSuccess("SUCCESS")})},t.getAttributeVerificationCode=function(e,s,i){if(this.signInUserSession==null||!this.signInUserSession.isValid())return s.onFailure(new Error("User is not authenticated"));this.client.request("GetUserAttributeVerificationCode",{AttributeName:e,AccessToken:this.signInUserSession.getAccessToken().getJwtToken(),ClientMetadata:i},function(o,a){return o?s.onFailure(o):typeof s.inputVerificationCode=="function"?s.inputVerificationCode(a):s.onSuccess("SUCCESS")})},t.verifyAttribute=function(e,s,i){if(this.signInUserSession==null||!this.signInUserSession.isValid())return i.onFailure(new Error("User is not authenticated"));this.client.request("VerifyUserAttribute",{AttributeName:e,Code:s,AccessToken:this.signInUserSession.getAccessToken().getJwtToken()},function(o){return o?i.onFailure(o):i.onSuccess("SUCCESS")})},t.getDevice=function(e){if(this.signInUserSession==null||!this.signInUserSession.isValid())return e.onFailure(new Error("User is not authenticated"));this.client.request("GetDevice",{AccessToken:this.signInUserSession.getAccessToken().getJwtToken(),DeviceKey:this.deviceKey},function(s,i){return s?e.onFailure(s):e.onSuccess(i)})},t.forgetSpecificDevice=function(e,s){if(this.signInUserSession==null||!this.signInUserSession.isValid())return s.onFailure(new Error("User is not authenticated"));this.client.request("ForgetDevice",{AccessToken:this.signInUserSession.getAccessToken().getJwtToken(),DeviceKey:e},function(i){return i?s.onFailure(i):s.onSuccess("SUCCESS")})},t.forgetDevice=function(e){var s=this;this.forgetSpecificDevice(this.deviceKey,{onFailure:e.onFailure,onSuccess:function(o){return s.deviceKey=null,s.deviceGroupKey=null,s.randomPassword=null,s.clearCachedDeviceKeyAndPassword(),e.onSuccess(o)}})},t.setDeviceStatusRemembered=function(e){if(this.signInUserSession==null||!this.signInUserSession.isValid())return e.onFailure(new Error("User is not authenticated"));this.client.request("UpdateDeviceStatus",{AccessToken:this.signInUserSession.getAccessToken().getJwtToken(),DeviceKey:this.deviceKey,DeviceRememberedStatus:"remembered"},function(s){return s?e.onFailure(s):e.onSuccess("SUCCESS")})},t.setDeviceStatusNotRemembered=function(e){if(this.signInUserSession==null||!this.signInUserSession.isValid())return e.onFailure(new Error("User is not authenticated"));this.client.request("UpdateDeviceStatus",{AccessToken:this.signInUserSession.getAccessToken().getJwtToken(),DeviceKey:this.deviceKey,DeviceRememberedStatus:"not_remembered"},function(s){return s?e.onFailure(s):e.onSuccess("SUCCESS")})},t.listDevices=function(e,s,i){if(this.signInUserSession==null||!this.signInUserSession.isValid())return i.onFailure(new Error("User is not authenticated"));var o={AccessToken:this.signInUserSession.getAccessToken().getJwtToken(),Limit:e};s&&(o.PaginationToken=s),this.client.request("ListDevices",o,function(a,u){return a?i.onFailure(a):i.onSuccess(u)})},t.globalSignOut=function(e){var s=this;if(this.signInUserSession==null||!this.signInUserSession.isValid())return e.onFailure(new Error("User is not authenticated"));this.client.request("GlobalSignOut",{AccessToken:this.signInUserSession.getAccessToken().getJwtToken()},function(i){return i?e.onFailure(i):(s.clearCachedUser(),e.onSuccess("SUCCESS"))})},t.signOut=function(e){var s=this;if(!e||typeof e!="function"){this.cleanClientData();return}this.getSession(function(i,o){if(i)return e(i);s.revokeTokens(function(a){s.cleanClientData(),e(a)})})},t.revokeTokens=function(e){if(e===void 0&&(e=function(){}),typeof e!="function")throw new Error("Invalid revokeTokenCallback. It should be a function.");if(!this.signInUserSession){var s=new Error("User is not authenticated");return e(s)}if(!this.signInUserSession.getAccessToken()){var i=new Error("No Access token available");return e(i)}var o=this.signInUserSession.getRefreshToken().getToken(),a=this.signInUserSession.getAccessToken();if(this.isSessionRevocable(a)&&o)return this.revokeToken({token:o,callback:e});e()},t.isSessionRevocable=function(e){if(e&&typeof e.decodePayload=="function")try{var s=e.decodePayload(),i=s.origin_jti;return!!i}catch{}return!1},t.cleanClientData=function(){this.signInUserSession=null,this.clearCachedUser()},t.revokeToken=function(e){var s=e.token,i=e.callback;this.client.requestWithRetry("RevokeToken",{Token:s,ClientId:this.pool.getClientId()},function(o){if(o)return i(o);i()})},t.sendMFASelectionAnswer=function(e,s){var i=this,o={};o.USERNAME=this.username,o.ANSWER=e;var a={ChallengeName:"SELECT_MFA_TYPE",ChallengeResponses:o,ClientId:this.pool.getClientId(),Session:this.Session};this.getUserContextData()&&(a.UserContextData=this.getUserContextData()),this.client.request("RespondToAuthChallenge",a,function(u,h){if(u)return s.onFailure(u);if(i.Session=h.Session,e==="SMS_MFA")return s.mfaRequired(h.ChallengeName,h.ChallengeParameters);if(e==="SOFTWARE_TOKEN_MFA")return s.totpRequired(h.ChallengeName,h.ChallengeParameters)})},t.getUserContextData=function(){var e=this.pool;return e.getUserContextData(this.username)},t.associateSoftwareToken=function(e){var s=this;this.signInUserSession!=null&&this.signInUserSession.isValid()?this.client.request("AssociateSoftwareToken",{AccessToken:this.signInUserSession.getAccessToken().getJwtToken()},function(i,o){return i?e.onFailure(i):e.associateSecretCode(o.SecretCode)}):this.client.request("AssociateSoftwareToken",{Session:this.Session},function(i,o){return i?e.onFailure(i):(s.Session=o.Session,e.associateSecretCode(o.SecretCode))})},t.verifySoftwareToken=function(e,s,i){var o=this;this.signInUserSession!=null&&this.signInUserSession.isValid()?this.client.request("VerifySoftwareToken",{AccessToken:this.signInUserSession.getAccessToken().getJwtToken(),UserCode:e,FriendlyDeviceName:s},function(a,u){return a?i.onFailure(a):i.onSuccess(u)}):this.client.request("VerifySoftwareToken",{Session:this.Session,UserCode:e,FriendlyDeviceName:s},function(a,u){if(a)return i.onFailure(a);o.Session=u.Session;var h={};h.USERNAME=o.username;var f={ChallengeName:"MFA_SETUP",ClientId:o.pool.getClientId(),ChallengeResponses:h,Session:o.Session};o.getUserContextData()&&(f.UserContextData=o.getUserContextData()),o.client.request("RespondToAuthChallenge",f,function(l,d){return l?i.onFailure(l):(o.signInUserSession=o.getCognitoUserSession(d.AuthenticationResult),o.cacheTokens(),i.onSuccess(o.signInUserSession))})})},r}();function R(){}R.prototype.userAgent=ft();var St=function(t){var n=R.category?" "+R.category:"",e=R.framework?" framework/"+R.framework:"",s=""+R.prototype.userAgent+n+e;return s};function pt(r,t){r.prototype=Object.create(t.prototype),r.prototype.constructor=r,M(r,t)}function Z(r){var t=typeof Map=="function"?new Map:void 0;return Z=function(e){if(e===null||!Ct(e))return e;if(typeof e!="function")throw new TypeError("Super expression must either be null or a function");if(typeof t<"u"){if(t.has(e))return t.get(e);t.set(e,s)}function s(){return j(e,arguments,X(this).constructor)}return s.prototype=Object.create(e.prototype,{constructor:{value:s,enumerable:!1,writable:!0,configurable:!0}}),M(s,e)},Z(r)}function j(r,t,n){return mt()?j=Reflect.construct.bind():j=function(s,i,o){var a=[null];a.push.apply(a,i);var u=Function.bind.apply(s,a),h=new u;return o&&M(h,o.prototype),h},j.apply(null,arguments)}function mt(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Ct(r){return Function.toString.call(r).indexOf("[native code]")!==-1}function M(r,t){return M=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,s){return e.__proto__=s,e},M(r,t)}function X(r){return X=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},X(r)}var Ut=function(r){pt(t,r);function t(n,e,s,i){var o;return o=r.call(this,n)||this,o.code=e,o.name=s,o.statusCode=i,o}return t}(Z(Error)),yt=function(){function r(n,e,s){this.endpoint=e||"https://cognito-idp."+n+".amazonaws.com/";var i=s||{},o=i.credentials;this.fetchOptions=o?{credentials:o}:{}}var t=r.prototype;return t.promisifyRequest=function(e,s){var i=this;return new Promise(function(o,a){i.request(e,s,function(u,h){u?a(new Ut(u.message,u.code,u.name,u.statusCode)):o(h)})})},t.requestWithRetry=function(e,s,i){var o=this,a=5*1e3;Tt(function(u){return new Promise(function(h,f){o.request(e,u,function(l,d){l?f(l):h(d)})})},[s],a).then(function(u){return i(null,u)}).catch(function(u){return i(u)})},t.request=function(e,s,i){var o={"Content-Type":"application/x-amz-json-1.1","X-Amz-Target":"AWSCognitoIdentityProviderService."+e,"X-Amz-User-Agent":St(),"Cache-Control":"no-store"},a=Object.assign({},this.fetchOptions,{headers:o,method:"POST",mode:"cors",body:JSON.stringify(s)}),u;fetch(this.endpoint,a).then(function(h){return u=h,h},function(h){throw h instanceof TypeError?new Error("Network error"):h}).then(function(h){return h.json().catch(function(){return{}})}).then(function(h){if(u.ok)return i(null,h);var f=(h.__type||h.code).split("#").pop(),l=new Error(h.message||h.Message||null);return l.name=f,l.code=f,i(l)}).catch(function(h){if(u&&u.headers&&u.headers.get("x-amzn-errortype"))try{var f=u.headers.get("x-amzn-errortype").split(":")[0],l=new Error(u.status?u.status.toString():null);return l.code=f,l.name=f,l.statusCode=u.status,i(l)}catch{return i(h)}else h instanceof Error&&h.message==="Network error"&&(h.code="NetworkError");return i(h)})},r}(),L={debug:function(){}},At=function(t){var n="nonRetryable";return t&&t[n]};function ve(r,t,n,e){if(e===void 0&&(e=1),typeof r!="function")throw Error("functionToRetry must be a function");return L.debug(r.name+" attempt #"+e+" with args: "+JSON.stringify(t)),r.apply(void 0,t).catch(function(s){if(L.debug("error on "+r.name,s),At(s))throw L.debug(r.name+" non retryable error",s),s;var i=n(e,t,s);if(L.debug(r.name+" retrying in "+i+" ms"),i!==!1)return new Promise(function(o){return setTimeout(o,i)}).then(function(){return ve(r,t,n,e+1)});throw s})}function Dt(r){var t=100,n=100;return function(e){var s=Math.pow(2,e)*t+n*Math.random();return s>r?!1:s}}var wt=5*60*1e3;function Tt(r,t,n){return n===void 0&&(n=wt),ve(r,t,Dt(n))}/*!
 * Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
 * SPDX-License-Identifier: Apache-2.0
 */var It=55,Nt=function(){function r(n,e){var s=n||{},i=s.UserPoolId,o=s.ClientId,a=s.endpoint,u=s.fetchOptions,h=s.AdvancedSecurityDataCollectionFlag;if(!i||!o)throw new Error("Both UserPoolId and ClientId are required.");if(i.length>It||!/^[\w-]+_[0-9a-zA-Z]+$/.test(i))throw new Error("Invalid UserPoolId format.");var f=i.split("_")[0];this.userPoolId=i,this.clientId=o,this.client=new yt(f,a,u),this.advancedSecurityDataCollectionFlag=h!==!1,this.storage=n.Storage||new ge().getStorage(),e&&(this.wrapRefreshSessionCallback=e)}var t=r.prototype;return t.getUserPoolId=function(){return this.userPoolId},t.getUserPoolName=function(){return this.getUserPoolId().split("_")[1]},t.getClientId=function(){return this.clientId},t.signUp=function(e,s,i,o,a,u){var h=this,f={ClientId:this.clientId,Username:e,Password:s,UserAttributes:i,ValidationData:o,ClientMetadata:u};this.getUserContextData(e)&&(f.UserContextData=this.getUserContextData(e)),this.client.request("SignUp",f,function(l,d){if(l)return a(l,null);var g={Username:e,Pool:h,Storage:h.storage},S={user:new ce(g),userConfirmed:d.UserConfirmed,userSub:d.UserSub,codeDeliveryDetails:d.CodeDeliveryDetails};return a(null,S)})},t.getCurrentUser=function(){var e="CognitoIdentityServiceProvider."+this.clientId+".LastAuthUser",s=this.storage.getItem(e);if(s){var i={Username:s,Pool:this,Storage:this.storage};return new ce(i)}return null},t.getUserContextData=function(e){if(!(typeof AmazonCognitoAdvancedSecurityData>"u")){var s=AmazonCognitoAdvancedSecurityData;if(this.advancedSecurityDataCollectionFlag){var i=s.getData(e,this.userPoolId,this.clientId);if(i){var o={EncodedData:i};return o}}return{}}},r}();export{_t as A,Nt as C,ce as a};
